<!DOCTYPE html>
<html>
<head lang="en">
	<script src="https://cdn.pubnub.com/pubnub.min.js"></script>
	<script src="../jquery-2.1.3.min.js" type="text/javascript"></script>

	<meta charset="UTF-8">
	<title></title>
	<!-- Instantiate PubNub -->
	<script type="text/javascript">
		var pub = PUBNUB.init({
			publish_key  : 'pub-c-7d87a3c4-b1b8-4d33-be38-43b78065bc90',
			subscribe_key: 'sub-c-9d63a2c0-9665-11e4-9a03-02ee2ddab7fe',
		});
		var userId = 47;
		var channel = userId;
		$.ajax({
			type: "POST",
			url : 'http://localhost:8080/chat/login',
            data   : {channel:channel},
			success: function (res)
			{
				console.log('chatId:' + channel);
				subscribe();
			},
			error  : function (res, err)
			{
				console.log('error! respnse :');
				console.log(arguments);
			}
		});

		function getPartners() {
			$.ajax({
				type: "POST",
				url : 'http://localhost:8080/chat/getPartners',
				data   : {userId:userId},
				success: function (res)
				{
					console.log('getPartners Success ! partners:');
					console.log(res);
				},
				error  : function (res, err)
				{
					console.log('getPartners error! respnse :');
					console.log(arguments);
				}
			});

		}


		function subscribe()
		{
			pub.subscribe({
				channel: channel,
				message: function (m)
				{
					$('#msgBox').append(m.msg + ' <br />');
				},
				connect: function ()
				{
					console.log('subscribed to ' + channel);
					pub.publish({
						channel: channel,
						message: {"msg": 'Bob Entered Chat !'}
					});
				},
				restore: true
			});

		}


		function send()
		{
			pub.publish({
				channel: channel,
				message: {"msg": $('#textInput').html()}
			});

		}

		$(document).ready(function ()
		{
			$('#sendButton').click(send);
			getPartners();
/*
			pub.here_now({
				channel : 'demo_tutorial',
				callback: function (m)
				{
					console.log('herenow:');
					console.log(m)
				}
			});
*/
		})
	</script>
</head>
<body>
<h2>
	Bob : </h2>

<div contenteditable="true" id='textInput'
	 style="border: 1px solid lightgray;border-radius: 5px;margin: 30px 0 15px 20px; width:300px; height: 40px"></div>

<input id='sendButton' type="button" value="Send" style="margin: 0 0 0 20px;"/>

<div style="margin: 20px; border:1px solid lightgray" id="msgBox">

</div>
</body>
</html>

